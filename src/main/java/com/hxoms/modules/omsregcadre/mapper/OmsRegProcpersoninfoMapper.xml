<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hxoms.modules.omsregcadre.mapper.OmsRegProcpersoninfoMapper">
  <resultMap id="BaseResultMap" type="com.hxoms.modules.omsregcadre.entity.OmsRegProcpersoninfo">
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="A0100" jdbcType="VARCHAR" property="a0100" />
    <result column="RF_B0000" jdbcType="VARCHAR" property="rfB0000" />
    <result column="INBOUND_FLAG" jdbcType="CHAR" property="inboundFlag" />
    <result column="RF_STATUS" jdbcType="CHAR" property="rfStatus" />
    <result column="CHECK_STATUS" jdbcType="CHAR" property="checkStatus" />
    <result column="INCUMBENCY_STATUS" jdbcType="CHAR" property="incumbencyStatus" />
    <result column="DATA_TYPE" jdbcType="CHAR" property="dataType" />
    <result column="SURNAME" jdbcType="VARCHAR" property="surname" />
    <result column="NAME" jdbcType="VARCHAR" property="name" />
    <result column="SEX" jdbcType="VARCHAR" property="sex" />
    <result column="BIRTH_DATE" jdbcType="DATE" property="birthDate" />
    <result column="BIRTH_DATE_GB" jdbcType="DATE" property="birthDateGb" />
    <result column="BIRTH_DATE_GA" jdbcType="DATE" property="birthDateGa" />
    <result column="NATION_CODE" jdbcType="VARCHAR" property="nationCode" />
    <result column="NATION_NAME" jdbcType="VARCHAR" property="nationName" />
    <result column="IDNUMBER_GB" jdbcType="CHAR" property="idnumberGb" />
    <result column="IDNUMBER_GA" jdbcType="CHAR" property="idnumberGa" />
    <result column="POLITICAL_AFFICODE" jdbcType="VARCHAR" property="politicalAfficode" />
    <result column="POLITICAL_AFFINAME" jdbcType="VARCHAR" property="politicalAffiname" />
    <result column="HEALTH_CODE" jdbcType="VARCHAR" property="healthCode" />
    <result column="HEALTH" jdbcType="VARCHAR" property="health" />
    <result column="REGISTE_RESIDENCE_CODE" jdbcType="VARCHAR" property="registeResidenceCode" />
    <result column="REGISTE_RESIDENCE" jdbcType="VARCHAR" property="registeResidence" />
    <result column="WORK_UNIT" jdbcType="VARCHAR" property="workUnit" />
    <result column="POST_CODE" jdbcType="VARCHAR" property="postCode" />
    <result column="POST" jdbcType="VARCHAR" property="post" />
    <result column="PERSON_MANAGER" jdbcType="VARCHAR" property="personManager" />
    <result column="IDENTITY_CODE" jdbcType="CHAR" property="identityCode" />
    <result column="IDENTITY" jdbcType="VARCHAR" property="identity" />
    <result column="SECRET_LEVEL" jdbcType="VARCHAR" property="secretLevel" />
    <result column="DECRYPT_STARTDATE" jdbcType="DATE" property="decryptStartdate" />
    <result column="DECRYPT_ENDDATE" jdbcType="DATE" property="decryptEnddate" />
    <result column="MAIN_LEADER" jdbcType="CHAR" property="mainLeader" />
    <result column="LICENCE_IDENTITY" jdbcType="INTEGER" property="licenceIdentity" />
    <result column="NF" jdbcType="CHAR" property="nf" />
    <result column="FJGNF" jdbcType="CHAR" property="fjgnf" />
    <result column="XRXGW" jdbcType="CHAR" property="xrxgw" />
    <result column="LQGZ" jdbcType="CHAR" property="lqgz" />
    <result column="DQGZ" jdbcType="CHAR" property="dqgz" />
    <result column="REPLYOPINION" jdbcType="CHAR" property="replyopinion" />
    <result column="ABROADTIME" jdbcType="DATE" property="abroadtime" />
    <result column="REASON" jdbcType="VARCHAR" property="reason" />
    <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime" />
    <result column="CREATE_USER" jdbcType="VARCHAR" property="createUser" />
    <result column="MODIFY_TIME" jdbcType="TIMESTAMP" property="modifyTime" />
    <result column="MODIFY_USER" jdbcType="VARCHAR" property="modifyUser" />
    <result column="SORT_ID" jdbcType="INTEGER" property="sortId" />
    <result column="PY" jdbcType="VARCHAR" property="py" />
    <result column="SECRET_POST" jdbcType="VARCHAR" property="secretPost" />
    <result column="EXIT_DATE" jdbcType="DATE" property="exitDate" />
  </resultMap>
  <sql id="Base_Column_List">
    ID, A0100, RF_B0000, INBOUND_FLAG, RF_STATUS, CHECK_STATUS, INCUMBENCY_STATUS, DATA_TYPE, 
    SURNAME, NAME, SEX, BIRTH_DATE, BIRTH_DATE_GB,IDNUMBER_GA, NATION_CODE, NATION_NAME,
    IDNUMBER_GB,IDNUMBER_GA, POLITICAL_AFFICODE,POLITICAL_AFFINAME, HEALTH_CODE, HEALTH,
    REGISTE_RESIDENCE_CODE, REGISTE_RESIDENCE, WORK_UNIT, POST_CODE, POST, PERSON_MANAGER,
    IDENTITY_CODE, IDENTITY, SECRET_LEVEL, DECRYPT_STARTDATE, DECRYPT_ENDDATE, MAIN_LEADER,
    LICENCE_IDENTITY, NF, FJGNF, XRXGW, LQGZ, DQGZ, REPLYOPINION, ABROADTIME, REASON, CREATE_TIME,
    CREATE_USER, MODIFY_TIME,MODIFY_USER, SORT_ID, PY, SECRET_POST,EXIT_DATE
  </sql>


  <select id="selectRegProcpersonInfo" resultType="java.lang.String">
    select A0100 from OMS_REG_PROCPERSONINFO
  </select>

  <select id="selectProcpersoninfoList" resultMap="BaseResultMap" parameterType="com.hxoms.modules.omsregcadre.entity.OmsRegProcpersoninfo">
    select * from  OMS_REG_PROCPERSONINFO
    where  (RF_STATUS = 0 and DATA_TYPE = 1) or (INCUMBENCY_STATUS = 9 or DATA_TYPE = 2)
    <if test="rfB0000!=null and rfB0000!=''">
      and RF_B0000 = #{rfB0000}
    </if>
    order by SURNAME,NAME,WORK_UNIT asc
  </select>

  <select id="selectA0100ByMap" parameterType="java.util.Map" resultMap="BaseResultMap">
    select A0100,IDNUMBER
    from OMS_REG_PROCPERSONINFO t
    where 1=1
    <if test="name!=null and name!=''">
        and CONCAT(IFNULL(t.SURNAME,''),IFNULL(t.NAME,'')) = #{name}
    </if>
    <if test="birthDay!=null and birthDay!=''">
        and date_format(t.BIRTH_DATE, '%Y/%m') = #{birthDay}
    </if>
  </select>

  <select id="selectPersonAndAllowRevoke" parameterType="com.hxoms.modules.omsregcadre.entity.OmsRegProcpersoninfo" resultType="list">
    SELECT
      info.SURNAME,
      info.NAME,
      info.A0100,
    FROM oms_reg_procpersoninfo info
           LEFT JOIN oms_smr_personinfo smr on info.A0100 = smr.A0100
           LEFT JOIN a01 a1 on info.A0100 = a1.a0100
           LEFT JOIN a30 a3 on a1.a0100 = a3.a0100
    WHERE a3.a3001='免职'
    <if test="name!=null and name!=''">
      AND ((CONCAT(IFNULLLL(SURNAME,''),IFNULLLL(NAME,'')) LIKE '%${revokeapply.name}%') or (PY LIKE '%${name}%'))
    </if>
  </select>


  <insert id="batchAddorpInfo" parameterType="list">
      insert into oms_reg_procpersoninfo (ID, A0100, RF_B0000,
              INBOUND_FLAG, RF_STATUS, CHECK_STATUS,
              INCUMBENCY_STATUS, DATA_TYPE, SURNAME,
              NAME, SEX, BIRTH_DATE, BIRTH_DATE_GB,BIRTH_DATE_GA,NATION_CODE,
              NATION_NAME, IDNUMBER_GB,IDNUMBER_GA, POLITICAL_AFFI,
              HEALTH, REGISTE_RESIDENCE_CODE, REGISTE_RESIDENCE,
              WORK_UNIT, POST_CODE, POST,
              PERSON_MANAGER, IDENTITY_CODE, IDENTITY,
              SECRET_LEVEL, SECRET_STARTDATE, SECRET_ENDDATE,
              MAIN_LEADER, LICENCE_IDENTITY, NF,
              FJGNF, XRXGW, LQGZ, DQGZ,
              REPLYOPINION, ABROADTIME, REASON,
              CREATE_TIME,CREATE_USER,MODIFY_TIME,MODIFY_USER,
              SORT_ID,PY,SECRET_POST,EXIT_DATE
    )
    values
    <foreach collection="list" index="index" item="item" separator=",">
      (#{id,jdbcType=VARCHAR}, #{a0100,jdbcType=VARCHAR}, #{rfB0000,jdbcType=VARCHAR},
      #{inboundFlag,jdbcType=CHAR}, #{rfStatus,jdbcType=CHAR}, #{checkStatus,jdbcType=CHAR},
      #{incumbencyStatus,jdbcType=CHAR}, #{dataType,jdbcType=CHAR}, #{surname,jdbcType=VARCHAR},
      #{name,jdbcType=VARCHAR}, #{sex,jdbcType=VARCHAR}, #{birthDate,jdbcType=DATE},
      #{birthDateGb,jdbcType=DATE},#{birthDateGa,jdbcType=DATE},#{nationCode,jdbcType=VARCHAR},
      #{nationName,jdbcType=VARCHAR}, #{idnumber,jdbcType=CHAR}, #{politicalAffi,jdbcType=VARCHAR},
      #{health,jdbcType=VARCHAR}, #{registeResidenceCode,jdbcType=VARCHAR}, #{registeResidence,jdbcType=VARCHAR},
      #{workUnit,jdbcType=VARCHAR}, #{postCode,jdbcType=VARCHAR}, #{post,jdbcType=VARCHAR},
      #{personManager,jdbcType=VARCHAR}, #{identityCode,jdbcType=CHAR}, #{identity,jdbcType=VARCHAR},
      #{secretLevel,jdbcType=VARCHAR}, #{secretStartDate,jdbcType=DATE}, #{secretEndDate,jdbcType=DATE},
      #{mainLeader,jdbcType=CHAR}, #{licenceIdentity,jdbcType=INTEGER}, #{nf,jdbcType=CHAR},
      #{fjgnf,jdbcType=CHAR}, #{xrxgw,jdbcType=CHAR}, #{lqgz,jdbcType=CHAR}, #{dqgz,jdbcType=CHAR},
      #{replyopinion,jdbcType=CHAR}, #{abroadtime,jdbcType=DATE}, #{reason,jdbcType=VARCHAR}
      #{createTime,jdbcType=DATE}, #{createUser,jdbcType=VARCHAR},#{modifyTime,jdbcType=DATE},
      #{modifyUser,jdbcType=VARCHAR},#{sortId,jdbcType=VARCHAR},#{py,jdbcType=VARCHAR},
      #{secretPost,jdbcType=VARCHAR},#{exitDate,jdbcType=DATE}
      )
    </foreach>

	</insert>

    <select id="selectInboudFlagCount" resultType="com.hxoms.modules.omsregcadre.entity.StatisticsCountVo">
      SELECT
        T_Status.CODE,
        T_Status.NAM                                                  E,
        IFNULL(T_Main.Cnt, '0') VALUE
      FROM
        (
          SELECT * FROM (
                SELECT 'U' code, '新增' name
              UNION
                SELECT 'I' code, '修改' name
              UNION
                SELECT 'D' code, '撤销' name
            ) T_Status
        ) T_Status
        LEFT JOIN (
          SELECT INBOUND_FLAG, Count(INBOUND_FLAG) Cnt
          FROM oms_reg_procpersoninfo  GROUP BY  INBOUND_FLAG
        ) T_Main ON T_Main.INBOUND_FLAG = T_Status.code
    </select>

    <select id="selectIdentityCodeCount" resultType="com.hxoms.modules.omsregcadre.entity.StatisticsCountVo">
      SELECT
        T_Status.CODE,
        T_Status.NAME,
        IFNULL(T_Main.Cnt, '0') VALUE
      FROM
        (
        SELECT * FROM (
              SELECT '1' code, '省管干部' name
            UNION
              SELECT '2' code, '科级以上公务员' name
            UNION
              SELECT '3' code, '涉密人员' name
            UNION
              SELECT '4' code, '重要岗位人' name
            UNION
              SELECT '5' code, '重点监管人员' name
            UNION
              SELECT '9' code, '其他人员' name
            ) T_Status
        ) T_Status
        LEFT JOIN (
        SELECT IDENTITY_CODE, Count(IDENTITY_CODE) Cnt
        FROM oms_reg_procpersoninfo  GROUP BY  IDENTITY_CODE
        ) T_Main ON T_Main.IDENTITY_CODE = T_Status.code

    </select>

  <select id="selectAllFlagCount" resultType="com.hxoms.modules.omsregcadre.entity.StatisticsCountVo">
    select
      count(orp.MAIN_LEADER=1) as acount,-- 主要领导
      count(orp.NF='1') as bcount,-- 裸官
      count(orp.SECRET_LEVEL=3)as count,-- 核心涉密人员
      count(orp.SECRET_LEVEL=2) as dcount,-- 一般涉密人员
      count(orp.REPLYOPINION=1)as ecount,-- 纪委不回复意见人员1是，0否
      count(orp.LQGZ=1)as fcount, -- 离琼挂职
      count(orp.DQGZ=1)as gcount, -- 到琼挂职
      (select count(1) from oms_reg_procpersoninfo orp left join oms_sup_suspend_person oss on orp.A0100 = oss.A0100 where oss.status=0)as hcount  -- 锁定出国
    from oms_reg_procpersoninfo orp
  </select>


  <select id="selectMergeList" resultMap="BaseResultMap">
    select * from oms_reg_procpersoninfo where 1=1
    and (RF_STATUS = '0' AND DATA_TYPE = '1') or (CHECK_STATUS = '0' AND DATA_TYPE = '2')
    <if test="dataType!=null and dataType!=''">
      and DATA_TYPE=#{dataType}
    </if>
  </select>

</mapper>