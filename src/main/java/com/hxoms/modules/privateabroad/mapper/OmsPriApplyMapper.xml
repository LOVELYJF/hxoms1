<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hxoms.modules.privateabroad.mapper.OmsPriApplyMapper">
  <resultMap id="BaseResultMap" type="com.hxoms.modules.privateabroad.entity.OmsPriApply">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 28 09:29:31 CST 2020.
    -->
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="PROCPERSON_ID" jdbcType="VARCHAR" property="procpersonId" />
    <result column="A0100" jdbcType="VARCHAR" property="a0100" />
    <result column="B0100" jdbcType="VARCHAR" property="b0100" />
    <result column="POLITICAL_OUTLOOK" jdbcType="VARCHAR" property="politicalOutlook" />
    <result column="HEALTH" jdbcType="VARCHAR" property="health" />
    <result column="POSTRANK" jdbcType="VARCHAR" property="postrank" />
    <result column="ABROAD_TIME" jdbcType="TIMESTAMP" property="abroadTime" />
    <result column="RETURN_TIME" jdbcType="TIMESTAMP" property="returnTime" />
    <result column="GO_COUNTRY" jdbcType="VARCHAR" property="goCountry" />
    <result column="OUTSIDE_TIME" jdbcType="INTEGER" property="outsideTime" />
    <result column="ABROAD_REASONS" jdbcType="VARCHAR" property="abroadReasons" />
    <result column="APPLY_TIME" jdbcType="TIMESTAMP" property="applyTime" />
    <result column="REVERT_LICENCE_TIME" jdbcType="TIMESTAMP" property="revertLicenceTime" />
    <result column="CLASSIFICA_POST" jdbcType="VARCHAR" property="classificaPost" />
    <result column="CLASSIFICATION_LEVEL" jdbcType="VARCHAR" property="classificationLevel" />
    <result column="DECLASSIFICA_STARTTIME" jdbcType="TIMESTAMP" property="declassificaStarttime" />
    <result column="DECLASSIFICA_ENDTIME" jdbcType="TIMESTAMP" property="declassificaEndtime" />
    <result column="PAPER" jdbcType="INTEGER" property="paper" />
    <result column="REAL_GO_COUNTRY" jdbcType="VARCHAR" property="realGoCountry" />
    <result column="REAL_PASS_COUNTRY" jdbcType="VARCHAR" property="realPassCountry" />
    <result column="REAL_ABROAD_TIME" jdbcType="TIMESTAMP" property="realAbroadTime" />
    <result column="REAL_RETURN_TIME" jdbcType="TIMESTAMP" property="realReturnTime" />
    <result column="REAL_OUTSIDE_TIME" jdbcType="INTEGER" property="realOutsideTime" />
    <result column="DESCRIPTION" jdbcType="VARCHAR" property="description" />
    <result column="IS_TWO_PASSPORT" jdbcType="CHAR" property="isTwoPassport" />
    <result column="IS_ABROAD" jdbcType="CHAR" property="isAbroad" />
    <result column="COMPARISON_RESULT" jdbcType="VARCHAR" property="comparisonResult" />
    <result column="COMPARISON_DATE" jdbcType="TIMESTAMP" property="comparisonDate" />
    <result column="ABROAD_PHONE" jdbcType="VARCHAR" property="abroadPhone" />
    <result column="SFXYZQJWYJ" jdbcType="CHAR" property="sfxyzqjwyj" />
    <result column="SFZQJWYJ" jdbcType="CHAR" property="sfzqjwyj" />
    <result column="PASSPORT" jdbcType="INTEGER" property="passport" />
    <result column="PASSPORT_NUM" jdbcType="VARCHAR" property="passportNum" />
    <result column="HONGKONGANDMACAO_PASSPORT" jdbcType="INTEGER" property="hongkongandmacaoPassport" />
    <result column="HONGKONGANDMACAO_PASSPORT_NUM" jdbcType="VARCHAR" property="hongkongandmacaoPassportNum" />
    <result column="MACAO_VISA" jdbcType="INTEGER" property="macaoVisa" />
    <result column="HONGKONG_VISA" jdbcType="INTEGER" property="hongkongVisa" />
    <result column="TAIWAN_PASSPORT" jdbcType="INTEGER" property="taiwanPassport" />
    <result column="TAIWAN_PASSPORT_NUM" jdbcType="VARCHAR" property="taiwanPassportNum" />
    <result column="TAIWAN_VISA" jdbcType="INTEGER" property="taiwanVisa" />
    <result column="IS_LUOGUAN" jdbcType="CHAR" property="isLuoguan" />
    <result column="IS_SPOUSEANDCHILDREN_SUPERVISE" jdbcType="CHAR" property="isSpouseandchildrenSupervise" />
    <result column="IS_LEADERS" jdbcType="CHAR" property="isLeaders" />
    <result column="IS_SPECIALLY_APPROVED" jdbcType="CHAR" property="isSpeciallyApproved" />
    <result column="NEGATIVE_INFO" jdbcType="VARCHAR" property="negativeInfo" />
    <result column="PASSPORT_TERM" jdbcType="TIMESTAMP" property="passportTerm" />
    <result column="FUNDS_SOURCE" jdbcType="VARCHAR" property="fundsSource" />
    <result column="IS_COMPARISON" jdbcType="CHAR" property="isComparison" />
    <result column="APPLY_STATUS" jdbcType="INTEGER" property="applyStatus" />
    <result column="CANCEL_REASON" jdbcType="VARCHAR" property="cancelReason" />
    <result column="IS_ENTRUST" jdbcType="INTEGER" property="isEntrust" />
    <result column="REMARKS" jdbcType="VARCHAR" property="remarks" />
    <result column="CREATE_USER" jdbcType="VARCHAR" property="createUser" />
    <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime" />
    <result column="MODIFY_USER" jdbcType="VARCHAR" property="modifyUser" />
    <result column="MODIFY_TIME" jdbcType="TIMESTAMP" property="modifyTime" />
    <result column="SORT_ID" jdbcType="INTEGER" property="sortId" />
    <result column="leader_batch_id" jdbcType="VARCHAR" property="leaderBatchId" />
    <result column="SCZQJWYJSJ" jdbcType="TIMESTAMP" property="sczqjwyjsj" />
    <result column="CLSHSFTG" jdbcType="CHAR" property="clshsftg" />
    <result column="JDCJL" jdbcType="CHAR" property="jdcjl" />
    <result column="JWJL" jdbcType="CHAR" property="jwjl" />
    <result column="ZZJL" jdbcType="CHAR" property="zzjl" />
  </resultMap>
    <resultMap extends="BaseResultMap" id="ResultMapVO" type="com.hxoms.modules.privateabroad.entity.OmsPriApplyVO">
        <result column="name" jdbcType="VARCHAR" property="name" />
        <result column="sex" jdbcType="VARCHAR" property="sex" />
        <result column="b0101" jdbcType="VARCHAR" property="b0101" />
        <result column="birthDate" jdbcType="TIMESTAMP" property="birthDate" />
        <result column="identifyType" jdbcType="VARCHAR" property="identifyType" />
    </resultMap>
    <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 28 09:29:31 CST 2020.
    -->
    ID, PROCPERSON_ID, A0100, B0100, POLITICAL_OUTLOOK, HEALTH, POSTRANK, ABROAD_TIME, 
    RETURN_TIME, GO_COUNTRY, OUTSIDE_TIME, ABROAD_REASONS, APPLY_TIME, REVERT_LICENCE_TIME, 
    CLASSIFICA_POST, CLASSIFICATION_LEVEL, DECLASSIFICA_STARTTIME, DECLASSIFICA_ENDTIME, 
    PAPER, REAL_GO_COUNTRY, REAL_PASS_COUNTRY, REAL_ABROAD_TIME, REAL_RETURN_TIME, REAL_OUTSIDE_TIME, 
    DESCRIPTION, IS_TWO_PASSPORT, IS_ABROAD, COMPARISON_RESULT, COMPARISON_DATE, ABROAD_PHONE, SFXYZQJWYJ,
    SFZQJWYJ, PASSPORT, PASSPORT_NUM, HONGKONGANDMACAO_PASSPORT, HONGKONGANDMACAO_PASSPORT_NUM, 
    MACAO_VISA, HONGKONG_VISA, TAIWAN_PASSPORT, TAIWAN_PASSPORT_NUM, TAIWAN_VISA, IS_LUOGUAN, 
    IS_SPOUSEANDCHILDREN_SUPERVISE, IS_LEADERS, IS_SPECIALLY_APPROVED, NEGATIVE_INFO, 
    PASSPORT_TERM, FUNDS_SOURCE, IS_COMPARISON, APPLY_STATUS, CANCEL_REASON, IS_ENTRUST, 
    REMARKS, CREATE_USER, CREATE_TIME, MODIFY_USER, MODIFY_TIME, SORT_ID, leader_batch_id, 
    SCZQJWYJSJ, CLSHSFTG, JDCJL, JWJL, ZZJL
  </sql>


  <!--分页因私出国申请列表-->
  <select id="selectOmsPriApplyIPage" parameterType="com.hxoms.modules.privateabroad.entity.paramentity.OmsPriApplyIPageParam" resultMap="ResultMapVO">
    select pa.*,
    CONCAT(IFNULL(rp.SURNAME,''),IFNULL(rp.NAME,'')) as name,
    rp.SEX as sex,
    rp.BIRTH_DATE_GB as birthDate,
    rp.WORK_UNIT as b0101,
    rp.IDENTITY as identifyType
    from oms_pri_apply pa
    LEFT JOIN oms_reg_procpersoninfo rp on pa.PROCPERSON_ID = rp.ID
    left join oms_reg_procpersoninfo rp1 on pa.CREATE_USER = rp1.ID
    where 1=1
    <if test="params.applyStartTime != null and params.applyStopTime != null">
      and pa.APPLY_TIME &gt; #{params.applyStartTime} and pa.APPLY_TIME &lt; #{params.applyStopTime}
    </if>
    <if test="params.b0100 != null and params.b0100 != ''">
      and pa.b0100 like CONCAT(#{params.b0100},'%')
    </if>
    <if test="params.procpersonId != null and params.procpersonId !=''">
        and pa.PROCPERSON_ID = #{params.procpersonId}
    </if>
    <if test="params.procpersonId != null and params.procpersonId !=''">
        and pa.IS_COMPARISON = #{params.isComparison}
    </if>
    <if test="params.abroadStartTime != null and params.abroadEndTime != null">
      and pa.ABROAD_TIME &gt; #{params.abroadStartTime} and pa.ABROAD_TIME &lt; #{params.abroadEndTime}
    </if>
    <if test="params.name != null and params.name != ''">
      and CONCAT(IFNULL(rp.SURNAME,''),IFNULL(rp.NAME,'')) LIKE CONCAT('%',#{params.name},'%')
      or rp.PY LIKE  CONCAT('%',#{params.name},'%')
    </if>
    <if test="params.createUser != null and params.createUser != ''">
      and CONCAT(IFNULL(rp1.SURNAME,''),IFNULL(rp1.NAME,'')) LIKE CONCAT('%',#{params.createUser},'%')
      or rp1.PY LIKE CONCAT('%',#{params.createUser},'%')
    </if>
    <if test="params.applyStatus != null and params.applyStatus != ''">
      and pa.APPLY_STATUS in
      <foreach close=")" collection="params.applyStatus" index="index" item="item" open="(" separator=",">
        #{item}
      </foreach>
    </if>
    order by pa.APPLY_STATUS, pa.ABROAD_TIME
  </select>

  <!--通过人员id查询因私出国申请所需用户信息-->
  <select id="selectPersonInfoByA0100" parameterType="java.util.Map" resultType="com.hxoms.modules.privateabroad.entity.OmsPriApplyVO">
    select orp.A0100 as a0100,
           orp.ID as procpersonId,
           CONCAT(IFNULL(orp.SURNAME,''),IFNULL(orp.NAME,'')) as name,
           orp.SEX as sex,
           orp.BIRTH_DATE_GB as birthDate,
           orp.IDNUMBER_GB as idnumber,
           orp.POLITICAL_AFFINAME as politicalOutlook,
           orp.POST as postrank,
           orp.REGISTE_RESIDENCE as registeResidence,
           orp.WORK_UNIT as b0101,
           ifnull(orp.SECRET_LEVEL,0) as classificationLevel,
           orp.DECRYPT_STARTDATE as declassificaStarttime,
           orp.DECRYPT_ENDDATE as declassificaEndtime,
           orp.SECRET_POST as classificaPost,
           orp.MAIN_LEADER as isLeaders,
           orp.nf as isLuoguan,
           orp.fjgnf as isSpouseandchildrenSupervise,
           orp.RF_B0000 as b0100,
           orp.HEALTH as health,
           orp.LICENCE_IDENTITY as paper
    from oms_reg_procpersoninfo orp
    where 1=1
      and orp.ID= #{procpersonId}
  </select>

  <!--通过人员id查询因私出国申请所需用户信息-->
  <select id="selectPersonByKeyword" parameterType="java.lang.String" resultType="com.hxoms.modules.publicity.entity.PersonInfoVO">
    select orp.IDNUMBER_GB as idnumber,orp.A0100 as a0100, orp.SEX as sex,
           CONCAT(IFNULL(orp.SURNAME,''),IFNULL(orp.NAME,'')) as name,
           orp.BIRTH_DATE_GB as birthDate,
           orp.POST as job,
           orp.RF_B0000 as b0111,
           orp.WORK_UNIT as b0101,
           orp.POLITICAL_AFFINAME as POLITICAL_AFFI,
           orp.NATION_NAME as NATION,
           orp.ID as procpersonId
    from oms_reg_procpersoninfo orp
    where
        CONCAT(IFNULL(orp.SURNAME,''),IFNULL(orp.NAME,'')) like CONCAT('%',#{keyword},'%')
      or orp.PY like CONCAT('%',#{keyword},'%')
  </select>

  <!--申请详情-->
  <select id="selectPriApplyById" parameterType="java.lang.String" resultMap="ResultMapVO">
    select opa.*,
           CONCAT(IFNULL(orp.SURNAME,''),IFNULL(orp.NAME,'')) as name,
           orp.BIRTH_DATE_GB as birthDate,
           orp.SEX as sex,
           orp.IDNUMBER_GB as idnumber,
           orp.REGISTE_RESIDENCE as registeResidence,
           orp.WORK_UNIT as b0101,
           orp.IDENTITY as identifyType
    from oms_pri_apply opa left join oms_reg_procpersoninfo orp on opa.PROCPERSON_ID = orp.ID
    where opa.ID = #{id}
  </select>

  <!--基本流程数据统计-->
  <select id="selectCountStatus" resultType="com.hxoms.modules.privateabroad.entity.CountStatusResult">
    select "1.填写申请" as label, 1 as statusCode, count(0) as num from oms_pri_apply where APPLY_STATUS = 1
    union all
    select "2.生成材料" as label, 2 as statusCode, count(0) as num from oms_pri_apply where APPLY_STATUS = 2
    union all
    select "3.打印材料清单" as label, 3 as statusCode, count(0) as num from oms_pri_apply where APPLY_STATUS = 3
    union all
    select "4.自评" as label, 5 as statusCode, count(0) as num from oms_pri_apply where APPLY_STATUS = 5
  </select>

<!--撤销申请人员统计-->
  <select id="selectCancelInfor" parameterType="com.hxoms.modules.privateabroad.entity.paramentity.OmsPriApplyIPageParam" resultType="java.util.Map">
    select ID as procpersonId, WORK_UNIT as b0101,RF_B0000 AS b0111, CONCAT( IFNULL(SURNAME, ''), IFNULL(NAME, '') ) AS name, POST AS post from oms_reg_procpersoninfo where ID in
    (
      select PROCPERSON_ID from oms_pri_apply where apply_status = 31
      <if test="params.b0100 != null and params.b0100 != ''">
        and b0100 like CONCAT(#{params.b0100},'%')
      </if>
      <if test="params.abroadStartTime != null and params.abroadEndTime != null">
        and ABROAD_TIME &gt; #{params.abroadStartTime} and ABROAD_TIME &lt; #{params.abroadEndTime}
      </if>
      GROUP BY PROCPERSON_ID
    ) ORDER BY RF_B0000
  </select>
  <!--因私撤销统计-->
  <select id="cancelCount" parameterType="java.util.Map" resultType="java.lang.Integer">
    select count(1) from oms_pri_apply
    where id in
      (select apply_id from
        (select oaa.apply_id,step_code from oms_abroad_approval oaa LEFT JOIN oms_pri_apply opa on oaa.apply_id = opa.id
        where oaa.type = 'oms_pri_apply' and oaa.step_code != 31
        ORDER BY oaa.step_code desc  limit 0,1) a
        where 1=1
        <if test="step != null and step == 'a1'">
          and step_code &lt; 23
        </if>
        <if test="step != null and step == 'b1'">
          and step_code = 23
        </if>
        <if test="step != null and step == 'c1'">
          and step_code = 24
        </if>
        <if test="step != null and step == 'd1'">
          and step_code &gt; 24 and step_code &lt; 30
        </if>
    ) and apply_status = 31 and PROCPERSON_ID=#{id}
  </select>
  <select id="selectVisaSettingByCode" parameterType="java.util.Map" resultType="java.util.Map">
      select INFO_ID AS infoId, INFO_NAME AS infoName from oms_baseinfo_config where 1=1
      <if test="infoId != null">
          and PARENT_ID = #{infoId}
      </if>
      <if test="dictCode != null">
          and DICT_CODE = #{dictCode}
      </if>
      order by infoId
  </select>
  
  <select id="selectPriPubList" parameterType="java.lang.String" resultType="com.hxoms.modules.privateabroad.entity.OmsPriPubApply">

      select
        ID as id,
        A0100 as a0100,
        ABROAD_TIME as cgsj,
        RETURN_TIME as hgsj,
        GO_COUNTRY as sdgj,
        REAL_ABROAD_TIME as sjcgsj,
        REAL_RETURN_TIME as sjhgsj,
        IS_COMPARISON as isComparison,
        APPLY_TIME as applyTime,
        REAL_GO_COUNTRY as realGoCountry,
        PAPER as paper,
        PASSPORT as passport,
        PASSPORT_NUM as passportNum,
        HONGKONGANDMACAO_PASSPORT as hongkongandmacaoPassport,
        HONGKONGANDMACAO_PASSPORT as hongkongandmacaoPassportNum ,
        TAIWAN_PASSPORT as taiwanPassport,
        TAIWAN_PASSPORT_NUM as taiwanPassportNum,
        IS_ABROAD as isAbroad
      from oms_pri_apply where IS_ABROAD is not null and IS_COMPARISON=#{isComparison} and a0100=#{a0100}

    union

      select ID as id,A0100 as a0100,CGSJ as cgsj,HGSJ as hgsj,
           SDGJ as sdgj,SJCGSJ as sjchsj,SJHGSJ as sjhgsj,IS_COMPARISON as isComparison,
           '无' as applyTime,
           '无' as realGoCountry,
           '无' as paper,
           '无' as passport,
           '无' as passportNum,
           '无' as hongkongandmacaoPassport,
           '无' as hongkongandmacaoPassportNum ,
           '无' as taiwanPassport,
           '无' as taiwanPassportNum,
           '无' as isAbroad
      from oms_pub_apply where pwh like CONCAT('%',#{pwh},'%')
      and IS_COMPARISON=#{isComparison} and PROCPERSON_ID=#{procpersonId}

  </select>

    <!--查询禁止性、限制性、敏感性国家和地区-->
    <select id="selectSensitiveCountry" resultType="java.util.Map">
        select "限制性国家" as type,NAME_ZH as name
        from oms_sensitive_maintain sm left join country co on sm.COUNTRY_ID = co.ID
              where SENSITIVE_LIMIT_ID='ABE3012D-62B4-49A8-B90D-90A6DC866829'
        union all
        select "禁止性国家" as type,NAME_ZH as name
        from oms_sensitive_maintain sm left join country co on sm.COUNTRY_ID = co.ID
        where SENSITIVE_LIMIT_ID='ABE3012D-3FB4-4899-ADB2-DA8F2F78D0C0'
        union all
        select "敏感性国家" as type,NAME_ZH as name
        from oms_sensitive_maintain sm left join country co on sm.COUNTRY_ID = co.ID
           where SENSITIVE_LIMIT_ID='ABE3012D-A1AB-4C9C-9F75-EB47ABBA1B72'
    </select>
</mapper>