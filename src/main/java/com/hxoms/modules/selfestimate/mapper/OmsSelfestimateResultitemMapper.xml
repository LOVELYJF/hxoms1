<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hxoms.modules.selfestimate.mapper.OmsSelfestimateResultitemMapper">
  <resultMap id="BaseResultMap" type="com.hxoms.modules.selfestimate.entity.OmsSelfestimateResultitem">
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="SELFFILE_ID" jdbcType="VARCHAR" property="selffileId" />
    <result column="APPLY_ID" jdbcType="VARCHAR" property="applyId" />
    <result column="CHECK_ID" jdbcType="VARCHAR" property="checkId" />
    <result column="CHECK_RESULT" jdbcType="INTEGER" property="checkResult" />
    <result column="DESCRIPTION" jdbcType="VARCHAR" property="description" />
    <result column="PERSON_TYPE" jdbcType="VARCHAR" property="personType" />
    <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime" />
    <result column="CREATE_USER" jdbcType="VARCHAR" property="createUser" />
    <result column="MODIFY_TIME" jdbcType="TIMESTAMP" property="modifyTime" />
    <result column="MODIFY_USER" jdbcType="VARCHAR" property="modifyUser" />
  </resultMap>
  <sql id="Base_Column_List">
    ID, SELFFILE_ID, APPLY_ID, CHECK_ID, CHECK_RESULT, DESCRIPTION, PERSON_TYPE, CREATE_TIME, 
    CREATE_USER, MODIFY_TIME, MODIFY_USER
  </sql>

  <!--查询结果子集列表-->
  <select id="selectItemResultList" parameterType="java.util.Map" resultType="com.hxoms.modules.selfestimate.entity.OmsSelfestimateResultitemVO">
      select o1.ID as checkId, o1.CHECK_ITEM as checkItem,
      (select o2.ID as id from oms_selfestimate_resultitem o2
      where 1=1 and o2.CHECK_ID=o1.ID and o2.APPLY_ID = #{applyId} and o2.PERSON_TYPE = #{personType}) as id,
      (select o2.APPLY_ID as applyId from oms_selfestimate_resultitem o2
      where 1=1 and o2.CHECK_ID=o1.ID and o2.APPLY_ID = #{applyId} and o2.PERSON_TYPE = #{personType}) as applyId,
             ifnull((select o2.CHECK_RESULT as checkResult from oms_selfestimate_resultitem o2
                     where 1=1 and o2.CHECK_ID=o1.ID and o2.APPLY_ID = #{applyId} and o2.PERSON_TYPE = #{personType}),0) as checkResult,
      (select o2.DESCRIPTION as description from oms_selfestimate_resultitem o2
      where 1=1 and o2.CHECK_ID=o1.ID and o2.APPLY_ID = #{applyId} and o2.PERSON_TYPE = #{personType}) as description
      FROM oms_selfestimate_items o1
      WHERE 1=1 and o1.ENABLE = 1 and o1.SELFFILE_ID = #{selffileId}
  </select>
</mapper>