<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hxoms.modules.passportCard.initialise.mapper.CfCertificateHistoryRecordMapper">
  <resultMap id="BaseResultMap" type="com.hxoms.modules.passportCard.initialise.entity.CfCertificateHistoryRecord">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Oct 12 16:39:51 CST 2020.
    -->
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="OMS_ID" jdbcType="VARCHAR" property="omsId" />
    <result column="A0100" jdbcType="VARCHAR" property="a0100" />
    <result column="A0184" jdbcType="VARCHAR" property="a0184" />
    <result column="NAME" jdbcType="VARCHAR" property="name" />
    <result column="PY" jdbcType="VARCHAR" property="py" />
    <result column="SEX" jdbcType="VARCHAR" property="sex" />
    <result column="CSRQ" jdbcType="DATE" property="csrq" />
    <result column="GJ" jdbcType="VARCHAR" property="gj" />
    <result column="CSDD" jdbcType="VARCHAR" property="csdd" />
    <result column="ZJLX" jdbcType="INTEGER" property="zjlx" />
    <result column="ZJXS" jdbcType="VARCHAR" property="zjxs" />
    <result column="XPLX" jdbcType="VARCHAR" property="xplx" />
    <result column="ZJHM" jdbcType="VARCHAR" property="zjhm" />
    <result column="QFJG" jdbcType="VARCHAR" property="qfjg" />
    <result column="QFDD" jdbcType="VARCHAR" property="qfdd" />
    <result column="QFRQ" jdbcType="DATE" property="qfrq" />
    <result column="YXQZ" jdbcType="DATE" property="yxqz" />
    <result column="SAVE_STATUS" jdbcType="VARCHAR" property="saveStatus" />
    <result column="CARD_STATUS" jdbcType="VARCHAR" property="cardStatus" />
    <result column="SURELY_UNIT" jdbcType="VARCHAR" property="surelyUnit" />
    <result column="SURELY_WAY" jdbcType="VARCHAR" property="surelyWay" />
    <result column="CABINET_NUM" jdbcType="VARCHAR" property="cabinetNum" />
    <result column="PLACE" jdbcType="VARCHAR" property="place" />
    <result column="COUNTER_NUM" jdbcType="INTEGER" property="counterNum" />
    <result column="EXCEPTION_MESSAGE" jdbcType="VARCHAR" property="exceptionMessage" />
    <result column="EXCEPTION_CONCLUSION" jdbcType="VARCHAR" property="exceptionConclusion" />
    <result column="EXCEPTION_HANDLER" jdbcType="VARCHAR" property="exceptionHandler" />
    <result column="EXCEPTION_SOLVEDATE" jdbcType="TIMESTAMP" property="exceptionSolvedate" />
    <result column="COMPARISON_RESULT" jdbcType="VARCHAR" property="comparisonResult" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="YEAR" jdbcType="VARCHAR" property="year" />
    <result column="IMPORT_PERSON" jdbcType="VARCHAR" property="importPerson" />
    <result column="IMPORT_TIME" jdbcType="TIMESTAMP" property="importTime" />
    <result column="UPDATER" jdbcType="VARCHAR" property="updater" />
    <result column="UPDATE_TIME" jdbcType="TIMESTAMP" property="updateTime" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Oct 12 16:39:51 CST 2020.
    -->
    ID, OMS_ID, A0100, A0184, NAME, PY, SEX, CSRQ, GJ, CSDD, ZJLX, ZJXS, XPLX, ZJHM,
    QFJG, QFDD, QFRQ, YXQZ, SAVE_STATUS, CARD_STATUS, SURELY_UNIT, SURELY_WAY, CABINET_NUM,
    PLACE, COUNTER_NUM, EXCEPTION_MESSAGE, EXCEPTION_CONCLUSION, EXCEPTION_HANDLER, EXCEPTION_SOLVEDATE,
    COMPARISON_RESULT, REMARK, YEAR, IMPORT_PERSON, IMPORT_TIME, UPDATER, UPDATE_TIME
  </sql>
  <sql id="commonSql">
    SELECT
      a.ID id,
      a.OMS_ID omsId,
      b.RF_B0000 rfB0000,
      b.WORK_UNIT workUnit,
      (select item_name from sys_dict_item where dict_code='ZZZT' and item_code=b.INCUMBENCY_STATUS) incumbencyStatus,
      b.POST post,
      a.NAME name,
      if(a.sex='1','男',if(a.sex='2','女',a.sex)) sex,
      a.zjlx zjlx,
      (select item_name from sys_dict_item where dict_code='ZJLX' and item_code=a.zjlx) zjlxName,
      a.zjhm zjhm,
      a.yxqz yxqz,
      if(a.SURELY_UNIT='0','干部监督处',if(a.SURELY_UNIT='1','省委统战部(台办)',a.SURELY_UNIT)) surelyUnit,
      a.SURELY_WAY surelyWay,
      a.CABINET_NUM cabinetNum,
      a.PLACE place,
      a.CSRQ csrq,
      a.qfjg qfjg,
      a.QFRQ qfrq,
      a.CSDD csdd,
      a.EXCEPTION_MESSAGE exceptionMessage,
      a.gj,
      a.card_status cardStatus
    FROM
      cf_certificate_history_record a
        INNER JOIN oms_reg_procpersoninfo b ON a.OMS_ID = b.ID
  </sql>
  <select id="selectNotProvicdeCerRecord" resultType="com.hxoms.modules.passportCard.initialise.entity.CfCertificateHistoryRecord">
    <include refid="commonSql" />
    LEFT JOIN cf_certificate_collection c ON a.id=c.cer_id
    WHERE
    a.SAVE_STATUS = '2'
    AND a.CARD_STATUS = '5'
    <if test="year!=null and year !=''">
      AND a.year=#{year}
    </if>
    AND c.CJ_STATUS is null
  </select>

  <select id="selectExceptionCerRecord" resultType="com.hxoms.modules.passportCard.initialise.entity.CfCertificateHistoryRecord">
    <include refid="commonSql" />
    WHERE
    a.SAVE_STATUS = '1'
    AND a.CARD_STATUS in ('3','5')
    <if test="year!=null and year !=''">
      AND a.year=#{year}
    </if>
  </select>


</mapper>